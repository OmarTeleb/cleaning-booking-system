<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام حجز مواعيد خدمات التنظيف</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --confirmed: #2ecc71;
            --pending: #f39c12;
            --cancelled: #e74c3c;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-title {
            flex: 1;
        }
        
        h1 {
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        .subtitle {
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn:hover {
            background: var(--primary);
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background: var(--primary);
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-warning {
            background: var(--warning);
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-title {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
            font-size: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-actions {
            display: flex;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--secondary);
            color: var(--secondary);
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .customer-info {
            background: #e8f4fc;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            display: none;
        }
        
        .info-row {
            display: flex;
            margin-bottom: 10px;
        }
        
        .info-label {
            font-weight: 600;
            min-width: 100px;
        }
        
        .schedule {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }
        
        th {
            background-color: var(--primary);
            color: white;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .time-slot {
            padding: 8px;
            border-radius: 4px;
            margin: 2px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .available {
            background-color: #e8f6f3;
            color: #1d6a5b;
        }
        
        .available:hover {
            background-color: #c1e9e0;
        }
        
        .booked {
            background-color: #fde8e8;
            color: #c53030;
        }
        
        .selected {
            background-color: #d1ecf1;
            color: #0c5460;
            box-shadow: 0 0 0 2px var(--secondary);
        }
        
        .status-confirmed {
            background-color: var(--confirmed);
            color: white;
        }
        
        .status-pending {
            background-color: var(--pending);
            color: white;
        }
        
        .status-cancelled {
            background-color: var(--cancelled);
            color: white;
        }
        
        .worker-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        
        .worker-card {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            min-width: 180px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .worker-card.selected {
            border-color: var(--secondary);
            background-color: #e8f4fc;
        }
        
        .worker-name {
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .worker-schedule {
            font-size: 14px;
            color: #666;
        }
        
        .search-container {
            display: flex;
            gap: 10px;
        }
        
        #searchInput {
            flex: 1;
        }
        
        .setup-section {
            background: #fff8e1;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .error-message {
            color: var(--danger);
            padding: 10px;
            background: #fde8e8;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .success-message {
            color: var(--success);
            padding: 10px;
            background: #e8f6f3;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .calendar-view {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .calendar-day {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            min-height: 120px;
            background: white;
        }
        
        .calendar-day-header {
            font-weight: 600;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            margin-bottom: 5px;
            text-align: center;
        }
        
        .calendar-event {
            font-size: 12px;
            padding: 3px 5px;
            border-radius: 3px;
            margin-bottom: 3px;
            cursor: pointer;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
        
        .close-modal:hover {
            color: var(--danger);
        }
        
        @media (max-width: 768px) {
            .worker-selector {
                flex-direction: column;
            }
            
            .info-row {
                flex-direction: column;
            }
            
            .info-label {
                min-width: auto;
                margin-bottom: 5px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .calendar-view {
                grid-template-columns: repeat(1, 1fr);
            }
            
            header {
                flex-direction: column;
                gap: 15px;
            }
            
            .header-actions {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
    <!-- إضافة Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-title">
                <h1>نظام حجز مواعيد خدمات التنظيف</h1>
                <p class="subtitle">إدارة حجوزات العملاء وتنظيم مواعيد العاملات</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="loadData()">
                    <i class="fas fa-sync-alt"></i> تحديث البيانات
                </button>
                <button class="btn btn-success" onclick="showModal('addCustomer')">
                    <i class="fas fa-user-plus"></i> عميل جديد
                </button>
                <button class="btn btn-success" onclick="showModal('addWorker')">
                    <i class="fas fa-user-plus"></i> عاملة جديدة
                </button>
                <button class="btn btn-warning" onclick="toggleLogin()">
                    <i class="fas fa-user"></i> <span id="loginText">تسجيل الدخول</span>
                </button>
            </div>
        </header>

        <!-- نموذج تسجيل الدخول -->
        <div id="loginSection" class="card" style="display: none;">
            <h2 class="card-title">تسجيل الدخول</h2>
            <div class="form-group">
                <label for="loginEmail">البريد الإلكتروني:</label>
                <input type="email" id="loginEmail" placeholder="example@email.com">
            </div>
            <div class="form-group">
                <label for="loginPassword">كلمة المرور:</label>
                <input type="password" id="loginPassword" placeholder="كلمة المرور">
            </div>
            <button class="btn btn-primary" onclick="login()">تسجيل الدخول</button>
            <button class="btn btn-success" onclick="showRegister()">إنشاء حساب جديد</button>
        </div>

        <!-- نموذج إنشاء حساب -->
        <div id="registerSection" class="card" style="display: none;">
            <h2 class="card-title">إنشاء حساب جديد</h2>
            <div class="form-group">
                <label for="registerEmail">البريد الإلكتروني:</label>
                <input type="email" id="registerEmail" placeholder="example@email.com">
            </div>
            <div class="form-group">
                <label for="registerPassword">كلمة المرور:</label>
                <input type="password" id="registerPassword" placeholder="كلمة المرور (6 أحرف على الأقل)">
            </div>
            <button class="btn btn-success" onclick="register()">إنشاء حساب</button>
            <button class="btn btn-primary" onclick="showLogin()">عودة لتسجيل الدخول</button>
        </div>

        <!-- محتوى النظام الرئيسي -->
        <div id="mainContent" style="display: none;">
            <div class="tabs">
                <div class="tab active" data-tab="booking">الحجوزات</div>
                <div class="tab" data-tab="customers">العملاء</div>
                <div class="tab" data-tab="workers">العاملات</div>
                <div class="tab" data-tab="calendar">التقويم</div>
            </div>
            
            <div class="tab-content active" id="bookingTab">
                <div class="card">
                    <h2 class="card-title">البحث عن العميل</h2>
                    <div class="search-container">
                        <input type="text" id="searchInput" placeholder="أدخل رقم جوال العميل للبحث...">
                        <button class="btn btn-search" onclick="searchCustomer()">
                            <i class="fas fa-search"></i> بحث
                        </button>
                    </div>
                    
                    <div id="customerInfo" class="customer-info">
                        <h3>بيانات العميل</h3>
                        <div class="info-row">
                            <span class="info-label">الاسم:</span>
                            <span id="customerName">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">رقم الجوال:</span>
                            <span id="customerPhone">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">العنوان:</span>
                            <span id="customerAddress">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">رابط الموقع:</span>
                            <a id="customerMap" href="#" target="_blank">عرض على الخريطة</a>
                        </div>
                        <div class="info-row">
                            <button class="btn btn-warning" onclick="editCustomer()">
                                <i class="fas fa-edit"></i> تعديل بيانات العميل
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title">اختر العاملة</h2>
                    <div class="worker-selector" id="workerSelector">
                        <div class="loading">جاري تحميل بيانات العاملات...</div>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title">الجدول الزمني <small id="selectedDateDisplay"></small></h2>
                    <div class="form-group">
                        <label for="datePicker">اختر التاريخ:</label>
                        <input type="date" id="datePicker">
                    </div>
                    
                    <div class="schedule">
                        <div id="scheduleLoading" class="loading">جاري تحميل الجدول...</div>
                        <table style="display: none;">
                            <thead>
                                <tr id="scheduleHeader">
                                    <th>الوقت</th>
                                </tr>
                            </thead>
                            <tbody id="scheduleBody">
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title">تأكيد الحجز</h2>
                    <div class="form-group">
                        <label for="serviceDuration">مدة الخدمة (ساعات):</label>
                        <select id="serviceDuration">
                            <option value="2">ساعتين</option>
                            <option value="3">3 ساعات</option>
                            <option value="4">4 ساعات</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="bookingStatus">حالة الحجز:</label>
                        <select id="bookingStatus">
                            <option value="pending">قيد الانتظار</option>
                            <option value="confirmed">مؤكد</option>
                            <option value="cancelled">ملغى</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>موعد الحجز:</label>
                        <div id="bookingSummary">لم يتم اختيار موعد بعد</div>
                    </div>
                    
                    <button class="btn btn-book" onclick="bookAppointment()">
                        <i class="fas fa-calendar-check"></i> تأكيد الحجز
                    </button>
                </div>
            </div>
            
            <div class="tab-content" id="customersTab">
                <div class="card">
                    <h2 class="card-title">إدارة العملاء</h2>
                    <div class="table-responsive">
                        <table id="customersTable">
                            <thead>
                                <tr>
                                    <th>الاسم</th>
                                    <th>رقم الجوال</th>
                                    <th>العنوان</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="4" class="loading">جاري تحميل بيانات العملاء...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="workersTab">
                <div class="card">
                    <h2 class="card-title">إدارة العاملات</h2>
                    <div class="table-responsive">
                        <table id="workersTable">
                            <thead>
                                <tr>
                                    <th>اسم العاملة</th>
                                    <th>رقم الجوال</th>
                                    <th>الحالة</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="4" class="loading">جاري تحميل بيانات العاملات...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="calendarTab">
                <div class="card">
                    <h2 class="card-title">تقويم الحجوزات</h2>
                    <div class="form-group">
                        <label for="calendarRange">عرض الحجوزات:</label>
                        <select id="calendarRange" onchange="changeCalendarView()">
                            <option value="day">يوم واحد</option>
                            <option value="week" selected>أسبوع كامل</option>
                        </select>
                    </div>
                    
                    <div id="calendarView" class="calendar-view">
                        <!-- سيتم ملء التقويم بالجافاسكريبت -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- نماذج الإضافة والتعديل -->
    <div id="addCustomer" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>إضافة عميل جديد</h2>
                <button class="close-modal" onclick="closeModal('addCustomer')">&times;</button>
            </div>
            <form id="customerForm" onsubmit="saveCustomer(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="newCustomerName">اسم العميل:</label>
                        <input type="text" id="newCustomerName" required>
                    </div>
                    <div class="form-group">
                        <label for="newCustomerPhone">رقم الجوال:</label>
                        <input type="text" id="newCustomerPhone" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="newCustomerAddress">العنوان:</label>
                    <textarea id="newCustomerAddress" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label for="newCustomerMap">رابط الموقع (خرائط جوجل):</label>
                    <input type="url" id="newCustomerMap">
                </div>
                <button type="submit" class="btn btn-success">حفظ العميل</button>
            </form>
        </div>
    </div>

    <div id="addWorker" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>إضافة عاملة جديدة</h2>
                <button class="close-modal" onclick="closeModal('addWorker')">&times;</button>
            </div>
            <form id="workerForm" onsubmit="saveWorker(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="newWorkerName">اسم العاملة:</label>
                        <input type="text" id="newWorkerName" required>
                    </div>
                    <div class="form-group">
                        <label for="newWorkerPhone">رقم الجوال:</label>
                        <input type="text" id="newWorkerPhone">
                    </div>
                </div>
                <div class="form-group">
                    <label for="newWorkerStatus">حالة العاملة:</label>
                    <select id="newWorkerStatus">
                        <option value="active">نشطة</option>
                        <option value="inactive">غير نشطة</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-success">حفظ العاملة</button>
            </form>
        </div>
    </div>

    <div id="editCustomer" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>تعديل بيانات العميل</h2>
                <button class="close-modal" onclick="closeModal('editCustomer')">&times;</button>
            </div>
            <form id="editCustomerForm" onsubmit="updateCustomer(event)">
                <input type="hidden" id="editCustomerId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="editCustomerName">اسم العميل:</label>
                        <input type="text" id="editCustomerName" required>
                    </div>
                    <div class="form-group">
                        <label for="editCustomerPhone">رقم الجوال:</label>
                        <input type="text" id="editCustomerPhone" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="editCustomerAddress">العنوان:</label>
                    <textarea id="editCustomerAddress" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label for="editCustomerMap">رابط الموقع (خرائط جوجل):</label>
                    <input type="url" id="editCustomerMap">
                </div>
                                <button type="submit" class="btn btn-success">تحديث البيانات</button>
            </form>
        </div>
    </div>

    <script>
        // تكوين Firebase - استبدل هذه القيم بقيم التكوين الخاصة بك من Firebase Console
        const firebaseConfig = {
            apiKey: "AIzaSyAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            authDomain: "your-project-id.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project-id.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        };

        // تهيئة Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // بيانات التطبيق
        let customers = [];
        let workers = [];
        let bookings = [];
        let selectedWorker = null;
        let selectedTime = null;
        let selectedDate = null;
        let selectedCustomer = null;
        let currentTab = 'booking';
        let currentUser = null;

        // عناصر DOM
        const loginSection = document.getElementById('loginSection');
        const registerSection = document.getElementById('registerSection');
        const mainContent = document.getElementById('mainContent');
        const loginText = document.getElementById('loginText');
        const customerInfoDiv = document.getElementById('customerInfo');
        const customerNameSpan = document.getElementById('customerName');
        const customerPhoneSpan = document.getElementById('customerPhone');
        const customerAddressSpan = document.getElementById('customerAddress');
        const customerMapLink = document.getElementById('customerMap');
        const scheduleBody = document.getElementById('scheduleBody');
        const scheduleHeader = document.getElementById('scheduleHeader');
        const scheduleLoading = document.getElementById('scheduleLoading');
        const scheduleTable = document.querySelector('.schedule table');
        const datePicker = document.getElementById('datePicker');
        const bookingSummary = document.getElementById('bookingSummary');
        const workerSelector = document.getElementById('workerSelector');
        const selectedDateDisplay = document.getElementById('selectedDateDisplay');

        // تهيئة التطبيق
        function initApp() {
            // التحقق من حالة المستخدم
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    loginText.textContent = 'تسجيل الخروج';
                    loginSection.style.display = 'none';
                    registerSection.style.display = 'none';
                    mainContent.style.display = 'block';
                    loadData();
                } else {
                    currentUser = null;
                    loginText.textContent = 'تسجيل الدخول';
                    loginSection.style.display = 'block';
                    registerSection.style.display = 'none';
                    mainContent.style.display = 'none';
                }
            });

            // تعيين التاريخ الحالي كتاريخ افتراضي
            const today = new Date();
            datePicker.value = formatDate(today);
            selectedDate = formatDate(today);
            selectedDateDisplay.textContent = `(${formatDateDisplay(today)})`;
            
            // إضافة مستمعات الأحداث
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
        }

        // تسجيل الدخول
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                showSuccess('تم تسجيل الدخول بنجاح');
            } catch (error) {
                showError('خطأ في تسجيل الدخول: ' + error.message);
            }
        }

        // إنشاء حساب
        async function register() {
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            
            try {
                await auth.createUserWithEmailAndPassword(email, password);
                showSuccess('تم إنشاء الحساب بنجاح');
            } catch (error) {
                showError('خطأ في إنشاء الحساب: ' + error.message);
            }
        }

        // تسجيل الخروج
        async function logout() {
            try {
                await auth.signOut();
                showSuccess('تم تسجيل الخروج بنجاح');
            } catch (error) {
                showError('خطأ في تسجيل الخروج: ' + error.message);
            }
        }

        // تبديل بين تسجيل الدخول وإنشاء حساب
        function toggleLogin() {
            if (currentUser) {
                logout();
            } else {
                loginSection.style.display = loginSection.style.display === 'none' ? 'block' : 'none';
                registerSection.style.display = 'none';
            }
        }

        function showRegister() {
            loginSection.style.display = 'none';
            registerSection.style.display = 'block';
        }

        function showLogin() {
            loginSection.style.display = 'block';
            registerSection.style.display = 'none';
        }

        // تحميل البيانات من Firebase
        async function loadData() {
            if (!currentUser) return;
            
            try {
                showLoading();
                
                // جلب العملاء
                const customersSnapshot = await db.collection('customers').get();
                customers = customersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                // جلب العاملات
                const workersSnapshot = await db.collection('workers').get();
                workers = workersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                // جلب الحجوزات
                const bookingsSnapshot = await db.collection('bookings').get();
                bookings = bookingsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                // عرض البيانات
                if (currentTab === 'booking') {
                    renderWorkers();
                    generateSchedule();
                } else if (currentTab === 'customers') {
                    renderCustomersTable();
                } else if (currentTab === 'workers') {
                    renderWorkersTable();
                } else if (currentTab === 'calendar') {
                    renderCalendar();
                }
                
                hideLoading();
                showSuccess('تم تحميل البيانات بنجاح');
                
            } catch (error) {
                console.error('Error loading data:', error);
                showError('حدث خطأ في تحميل البيانات');
            }
        }

        // البحث عن عميل
        function searchCustomer() {
            let searchValue = document.getElementById('searchInput').value.trim();
            
            if (!searchValue) {
                showError('يرجى إدخال رقم الجوال للبحث');
                return;
            }
            
            // تنظيف رقم الهاتف للبحث
            searchValue = cleanPhoneNumber(searchValue);
            
            const customer = customers.find(c => {
                const customerPhone = cleanPhoneNumber(c.phone);
                return customerPhone === searchValue;
            });
            
            if (customer) {
                selectedCustomer = customer;
                customerNameSpan.textContent = customer.name;
                customerPhoneSpan.textContent = customer.phone;
                customerAddressSpan.textContent = customer.address;
                customerMapLink.href = customer.mapLink || "#";
                customerInfoDiv.style.display = 'block';
            } else {
                showError('لم يتم العثور على عميل بهذا الرقم');
                customerInfoDiv.style.display = 'none';
            }
        }

        // تنظيف رقم الهاتف
        function cleanPhoneNumber(phone) {
            if (!phone) return '';
            return phone.toString().replace(/[\s\-\+\(\)]/g, '');
        }

        // عرض العاملات
        function renderWorkers() {
            if (workers.length === 0) {
                workerSelector.innerHTML = '<div class="loading">لا توجد بيانات للعاملات</div>';
                return;
            }
            
            workerSelector.innerHTML = '';
            
            workers.filter(w => w.status === 'active').forEach(worker => {
                const workerCard = document.createElement('div');
                workerCard.className = 'worker-card';
                workerCard.innerHTML = `
                    <div class="worker-name">${worker.name}</div>
                    <div class="worker-schedule">${worker.phone || 'لا يوجد رقم'}</div>
                `;
                
                workerCard.onclick = () => selectWorker(worker);
                workerSelector.appendChild(workerCard);
            });
        }

        // اختيار عاملة
        function selectWorker(worker) {
            selectedWorker = worker;
            
            // إزالة التحديد من جميع البطاقات
            document.querySelectorAll('.worker-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // إضافة التحديد للبطاقة المختارة
            event.currentTarget.classList.add('selected');
        }

        // إنشاء الجدول الزمني
        function generateSchedule() {
            if (!workers.length) {
                scheduleLoading.textContent = 'لا توجد بيانات للعاملات';
                return;
            }
            
            scheduleLoading.style.display = 'block';
            scheduleTable.style.display = 'none';
            
            setTimeout(() => {
                // مسح الجدول الحالي
                scheduleHeader.innerHTML = '<th>الوقت</th>';
                scheduleBody.innerHTML = '';
                
                // إضافة عناوين العاملات
                workers.filter(w => w.status === 'active').forEach(worker => {
                    const th = document.createElement('th');
                    th.textContent = worker.name;
                    scheduleHeader.appendChild(th);
                });
                
                // إنشاء الصفوف للجدول (من 8 صباحًا إلى 8 مساءً)
                for (let hour = 8; hour <= 20; hour++) {
                    const row = document.createElement('tr');
                    
                    // عمود الوقت
                    const timeCell = document.createElement('td');
                    timeCell.textContent = formatTime(hour);
                    row.appendChild(timeCell);
                    
                    // خلايا العاملات
                    workers.filter(w => w.status === 'active').forEach(worker => {
                        const workerCell = document.createElement('td');
                        
                        // التحقق من وجود حجز في هذا الوقت
                        const booking = bookings.find(b => 
                            b.workerId === worker.id && 
                            b.date === selectedDate && 
                            isTimeInRange(hour, b.startTime, getDuration(b.startTime, b.endTime))
                        );
                        
                        const timeSlot = document.createElement('div');
                        
                        if (booking) {
                            const customer = customers.find(c => c.id === booking.customerId);
                            timeSlot.className = `time-slot booked status-${booking.status}`;
                            timeSlot.textContent = customer ? customer.name : 'محجوز';
                            timeSlot.title = `حالة: ${getStatusText(booking.status)}`;
                        } else {
                            timeSlot.className = 'time-slot available';
                            timeSlot.textContent = 'متاح';
                            timeSlot.onclick = function() {
                                selectTimeSlot(worker, selectedDate, formatTime(hour));
                            };
                        }
                        
                        workerCell.appendChild(timeSlot);
                        row.appendChild(workerCell);
                    });
                    
                    scheduleBody.appendChild(row);
                }
                
                scheduleLoading.style.display = 'none';
                scheduleTable.style.display = 'table';
                
            }, 500);
        }

        // اختيار موعد
        function selectTimeSlot(worker, date, time) {
            if (!selectedCustomer) {
                showError('يرجى البحث عن عميل أولاً');
                return;
            }
            
            selectedWorker = worker;
            selectedTime = time;
            selectedDate = date;
            
            // إزالة التحديد من جميع الخلايا
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            
            // إضافة التحديد للخلية المختارة
            event.currentTarget.classList.add('selected');
            
            // تحديث ملخص الحجز
            bookingSummary.textContent = `${date} الساعة ${time} مع ${worker.name}`;
            
            // تحديد العاملة تلقائياً
            document.querySelectorAll('.worker-card').forEach(card => {
                const cardWorkerName = card.querySelector('.worker-name').textContent;
                if (cardWorkerName === worker.name) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
        }

        // حفظ عميل جديد في Firebase
        async function saveCustomer(event) {
            event.preventDefault();
            
            const name = document.getElementById('newCustomerName').value;
            const phone = document.getElementById('newCustomerPhone').value;
            const address = document.getElementById('newCustomerAddress').value;
            const mapLink = document.getElementById('newCustomerMap').value;
            
            try {
                const docRef = await db.collection('customers').add({
                    name,
                    phone,
                    address,
                    mapLink,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                customers.push({ id: docRef.id, name, phone, address, mapLink });
                document.getElementById('customerForm').reset();
                closeModal('addCustomer');
                
                showSuccess('تم添加 العميل بنجاح');
                renderCustomersTable();
            } catch (error) {
                showError('خطأ في حفظ العميل: ' + error.message);
            }
        }

        // حفظ عاملة جديدة في Firebase
        async function saveWorker(event) {
            event.preventDefault();
            
            const name = document.getElementById('newWorkerName').value;
            const phone = document.getElementById('newWorkerPhone').value;
            const status = document.getElementById('newWorkerStatus').value;
            
            try {
                const docRef = await db.collection('workers').add({
                    name,
                    phone,
                    status,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                workers.push({ id: docRef.id, name, phone, status });
                document.getElementById('workerForm').reset();
                closeModal('addWorker');
                
                showSuccess('تم添加 العاملة بنجاح');
                renderWorkersTable();
            } catch (error) {
                showError('خطأ في حفظ العاملة: ' + error.message);
            }
        }

        // حفظ حجز جديد في Firebase
        async function bookAppointment() {
            if (!selectedCustomer || !selectedWorker || !selectedTime) return;
            
            const duration = document.getElementById('serviceDuration').value;
            const status = document.getElementById('bookingStatus').value;
            
            try {
                const docRef = await db.collection('bookings').add({
                    customerId: selectedCustomer.id,
                    workerId: selectedWorker.id,
                    date: selectedDate,
                    startTime: selectedTime,
                    endTime: calculateEndTime(selectedTime, duration),
                    status,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                const newBooking = {
                    id: docRef.id,
                    customerId: selectedCustomer.id,
                    workerId: selectedWorker.id,
                    date: selectedDate,
                    startTime: selectedTime,
                    endTime: calculateEndTime(selectedTime, duration),
                    status
                };
                
                bookings.push(newBooking);
                showSuccess('تم الحجز بنجاح!');
                resetForm();
                generateSchedule();
            } catch (error) {
                showError('خطأ في الحجز: ' + error.message);
            }
        }

        // عرض جدول العملاء
        function renderCustomersTable() {
            const table = document.getElementById('customersTable');
            const tbody = table.querySelector('tbody');
            
            if (customers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="loading">لا توجد عملاء</td></tr>';
                return;
            }
            
            tbody.innerHTML = '';
            
            customers.forEach(customer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.name}</td>
                    <td>${customer.phone}</td>
                    <td>${customer.address || '-'}</td>
                    <td>
                        <button class="btn btn-warning" onclick="editCustomer('${customer.id}')">
                            <i class="fas fa-edit"></i> تعديل
                        </button>
                        <button class="btn btn-danger" onclick="deleteCustomer('${customer.id}')">
                            <i class="fas fa-trash"></i> حذف
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // عرض جدول العاملات
        function renderWorkersTable() {
            const table = document.getElementById('workersTable');
            const tbody = table.querySelector('tbody');
            
            if (workers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="loading">لا توجد عاملات</td></tr>';
                return;
            }
            
            tbody.innerHTML = '';
            
            workers.forEach(worker => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${worker.name}</td>
                    <td>${worker.phone || '-'}</td>
                    <td><span class="status-${worker.status}">${worker.status === 'active' ? 'نشطة' : 'غير نشطة'}</span></td>
                    <td>
                        <button class="btn btn-warning" onclick="editWorker('${worker.id}')">
                            <i class="fas fa-edit"></i> تعديل
                        </button>
                        <button class="btn btn-danger" onclick="deleteWorker('${worker.id}')">
                            <i class="fas fa-trash"></i> حذف
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // عرض التقويم
        function renderCalendar() {
            const calendarView = document.getElementById('calendarView');
            const range = document.getElementById('calendarRange').value;
            
            if (range === 'day') {
                renderDayCalendar();
            } else {
                renderWeekCalendar();
            }
        }

        // عرض تقويم اليوم
        function renderDayCalendar() {
            const calendarView = document.getElementById('calendarView');
            calendarView.innerHTML = '';
            
            const date = new Date(selectedDate);
            const dayName = getDayName(date.getDay());
            
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            dayElement.innerHTML = `
                <div class="calendar-day-header">${dayName} - ${formatDateDisplay(date)}</div>
            `;
            
            // إضافة الحجوزات لهذا اليوم
            const dayBookings = bookings.filter(b => b.date === selectedDate);
            dayBookings.forEach(booking => {
                const customer = customers.find(c => c.id === booking.customerId);
                const worker = workers.find(w => w.id === booking.workerId);
                
                if (customer && worker) {
                    const eventElement = document.createElement('div');
                    eventElement.className = `calendar-event status-${booking.status}`;
                    eventElement.innerHTML = `
                        <div>${booking.startTime} - ${booking.endTime}</div>
                        <div>${customer.name} - ${worker.name}</div>
                    `;
                    dayElement.appendChild(eventElement);
                }
            });
            
            calendarView.appendChild(dayElement);
        }

        // عرض تقويم الأسبوع
        function renderWeekCalendar() {
            const calendarView = document.getElementById('calendarView');
            calendarView.innerHTML = '';
            
            const today = new Date(selectedDate);
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay());
            
            for (let i = 0; i < 7; i++) {
                const currentDate = new Date(startOfWeek);
                currentDate.setDate(startOfWeek.getDate() + i);
                const dateString = formatDate(currentDate);
                const dayName = getDayName(currentDate.getDay());
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.innerHTML = `
                    <div class="calendar-day-header">${dayName}<br>${formatDateDisplay(currentDate)}</div>
                `;
                
                // إضافة الحجوزات لهذا اليوم
                const dayBookings = bookings.filter(b => b.date === dateString);
                dayBookings.forEach(booking => {
                    const customer = customers.find(c => c.id === booking.customerId);
                    const worker = workers.find(w => w.id === booking.workerId);
                    
                    if (customer && worker) {
                        const eventElement = document.createElement('div');
                        eventElement.className = `calendar-event status-${booking.status}`;
                        eventElement.innerHTML = `
                            <div>${booking.startTime} - ${booking.endTime}</div>
                            <div>${customer.name}</div>
                        `;
                        dayElement.appendChild(eventElement);
                    }
                });
                
                calendarView.appendChild(dayElement);
            }
        }

        // تغيير عرض التقويم
        function changeCalendarView() {
            renderCalendar();
        }

        // تحرير بيانات عميل
        function editCustomer(customerId) {
            const customer = customers.find(c => c.id === customerId);
            
            if (!customer) {
                showError('لم يتم العثور على العميل');
                return;
            }
            
            document.getElementById('editCustomerId').value = customer.id;
            document.getElementById('editCustomerName').value = customer.name;
            document.getElementById('editCustomerPhone').value = customer.phone;
            document.getElementById('editCustomerAddress').value = customer.address || '';
            document.getElementById('editCustomerMap').value = customer.mapLink || '';
            
            showModal('editCustomer');
        }

        // تحديث بيانات عميل
        async function updateCustomer(event) {
            event.preventDefault();
            
            const id = document.getElementById('editCustomerId').value;
            const name = document.getElementById('editCustomerName').value;
            const phone = document.getElementById('editCustomerPhone').value;
            const address = document.getElementById('editCustomerAddress').value;
            const mapLink = document.getElementById('editCustomerMap').value;
            
            try {
                await db.collection('customers').doc(id).update({
                    name,
                    phone,
                    address,
                    mapLink
                });
                
                // تحديث البيانات المحلية
                const customerIndex = customers.findIndex(c => c.id === id);
                if (customerIndex !== -1) {
                    customers[customerIndex] = { ...customers[customerIndex], name, phone, address, mapLink };
                }
                
                closeModal('editCustomer');
                showSuccess('تم تحديث بيانات العميل بنجاح');
                
                // تحديث العرض
                if (currentTab === 'customers') {
                    renderCustomersTable();
                }
            } catch (error) {
                showError('خطأ في تحديث البيانات: ' + error.message);
            }
        }

        // حذف عميل
        async function deleteCustomer(customerId) {
            if (!confirm('هل أنت متأكد من رغبتك في حذف هذا العميل؟')) {
                return;
            }
            
            try {
                await db.collection('customers').doc(customerId).delete();
                
                // تحديث البيانات المحلية
                customers = customers.filter(c => c.id !== customerId);
                
                showSuccess('تم حذف العميل بنجاح');
                renderCustomersTable();
            } catch (error) {
                showError('خطأ في حذف العميل: ' + error.message);
            }
        }

        // حذف عاملة
        async function deleteWorker(workerId) {
            if (!confirm('هل أنت متأكد من رغبتك في حذف هذه العاملة؟')) {
                return;
            }
            
            try {
                await db.collection('workers').doc(workerId).delete();
                
                // تحديث البيانات المحلية
                workers = workers.filter(w => w.id !== workerId);
                
                showSuccess('تم حذف العاملة بنجاح');
                renderWorkersTable();
            } catch (error) {
                showError('خطأ في حذف العاملة: ' + error.message);
            }
        }

        // إعادة تعيين النموذج
        function resetForm() {
            document.getElementById('searchInput').value = '';
            customerInfoDiv.style.display = 'none';
            document.querySelectorAll('.worker-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            bookingSummary.textContent = 'لم يتم اختيار موعد بعد';
            selectedWorker = null;
            selectedTime = null;
        }

        // عرض نموذج
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        // إغلاق نموذج
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // تبديل الألسنة
        function switchTab(tabName) {
            currentTab = tabName;
            
            // إزالة النشاط من جميع الألسنة
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // إخفاء جميع محتويات الألسنة
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // تفعيل اللسان المحدد
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}Tab`).classList.add('active');
            
            // تحميل البيانات الخاصة باللسان
            if (tabName === 'customers') {
                renderCustomersTable();
            } else if (tabName === 'workers') {
                renderWorkersTable();
            } else if (tabName === 'calendar') {
                renderCalendar();
            }
        }

        // وظائف مساعدة
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        function formatDateDisplay(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${day}/${month}/${year}`;
        }
        
        function formatTime(hour) {
            return `${hour}:00`;
        }
        
        function getDayName(dayIndex) {
            const days = ['الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];
            return days[dayIndex];
        }
        
        function isTimeInRange(hour, bookingTime, duration) {
            if (!bookingTime) return false;
            const bookingHour = parseInt(bookingTime.split(':')[0]);
            return hour >= bookingHour && hour < bookingHour + duration;
        }
        
        function getDuration(startTime, endTime) {
            if (!startTime || !endTime) return 0;
            const start = parseInt(startTime.split(':')[0]);
            const end = parseInt(endTime.split(':')[0]);
            return end - start;
        }
        
        function calculateEndTime(startTime, duration) {
            const startHour = parseInt(startTime.split(':')[0]);
            return `${startHour + parseInt(duration)}:00`;
        }
        
        function getStatusText(status) {
            const statuses = {
                'confirmed': 'مؤكد',
                'pending': 'قيد الانتظار',
                'cancelled': 'ملغى'
            };
            return statuses[status] || status;
        }
        
        function showLoading() {
            // يمكن إضافة مؤشر تحميل هنا
        }
        
        function hideLoading() {
            // إخفاء مؤشر التحميل
        }
        
        function showError(message) {
            alert(message);
        }
        
        function showSuccess(message) {
            console.log(message);
        }

        // تهيئة التطبيق عند التحميل
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
                <button type="submit"
